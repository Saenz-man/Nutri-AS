generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// üë§ PERFIL DEL NUTRI√ìLOGO (Edgar Uriel)
model User {
  id           String        @id @default(uuid())
  nombre       String
  apellido     String
  email        String        @unique
  password     String
  telefono     String
  carrera      String
  cumplea√±os   DateTime
  fotoPerfil   String?
  fotoBanner   String?
  status       UserStatus    @default(PENDING_PAYMENT)
  maxPatients  Int           @default(10)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  appointments Appointment[]
  patients     Patient[]
}

// üë• EXPEDIENTE DEL PACIENTE
model Patient {
  id              String          @id @default(uuid())
  expediente      String          @unique
  nombre          String
  apellido        String
  email           String?
  telefono        String?
  fechaNacimiento DateTime?
  sexo            String?
  foto            String?
  nutritionistId  String
  status          PatientStatus   @default(ACTIVO)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  talla           Float?          // ‚úÖ Necesario para el c√°lculo del IMC
  
  appointments    Appointment[]
  consultations   Consultation[]
  nutritionist    User            @relation(fields: [nutritionistId], references: [id])
}

// üìÖ CITA: El eje central del Historial Cl√≠nico
model Appointment {
  id              String           @id @default(uuid())
  fechaHora       DateTime
  motivo          String?          @default("Consulta de Seguimiento")
  status          String           @default("PENDIENTE") 
  patientId       String
  nutritionistId  String
  createdAt       DateTime         @default(now())

  // üîó RELACIONES CL√çNICAS (1:1)
  medicion        Medicion?        // Datos antropom√©tricos
  r24             R24?             // Recordatorio de 24 horas
  laboratorios    Laboratorio?     // ‚úÖ Corregido: Sin duplicidad ni listas
  plan            PlanAlimenticio? // Dieta asignada

  nutritionist    User             @relation(fields: [nutritionistId], references: [id])
  patient         Patient          @relation(fields: [patientId], references: [id])
}

// üìè BLOQUE: MEDICIONES ANTROPOM√âTRICAS
model Medicion {
  id                String      @id @default(uuid())
  appointmentId     String      @unique
  appointment       Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)

  // üü¢ B√°sicos
  peso              Float?
  talla             Float?
  tallaSentado      Float?
  envergadura       Float?

  // üî¥ Pan√≠culos / Pliegues (mm)
  triceps           Float?
  subescapular      Float?
  biceps            Float?
  crestaIliaca      Float?
  supraespinal      Float?
  abdominal         Float?
  muslo             Float?
  piernaPaniculo    Float?    
  // üîµ Bioimpedancia
  grasaEquipo       Float?
  agua              Float?
  grasaVisceral     Float?
  edadMetabolica    Int?
  masaOsea          Float?
  musculo         Float?   // ‚úÖ A√ëADIR ESTE: Para el % de M√∫sculo

  // üîò √çndices y Circunferencias
  imc               Float?
  icc               Float?
  cintura           Float?
  cadera            Float?
  brazoR            Float?
  brazoC            Float?
  piernaCirc        Float?
  estiloideo        Float?
  femur             Float?
  humero            Float?

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
}

// üß™ BLOQUE: ESTUDIOS DE LABORATORIO
model Laboratorio {
  id                String      @id @default(uuid())
  appointmentId     String      @unique
  appointment       Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)

  // üß™ Perfil Bioqu√≠mico
  sodio             Float?
  potasio           Float?
  cloro             Float?
  bicarbonato       Float?
  coTotal           Float?
  acidoUrico        Float?
  glucosaAyuno      Float?
  glucosa1hr        Float?
  glucosa2hr        Float?
  hbGlucosilada     Float?
  creatinina        Float?
  urea              Float?
  albumina          Float?
  calcioTotal       Float?
  fosforo           Float?

  // ü•© Perfil Lip√≠dico
  colesterolTotal   Float?
  hdl               Float?
  ldl               Float?
  vldl              Float?
  trigliceridos     Float?
  lipidosTotales    Float?
  indiceAterogenico Float?

  // üöΩ Examen de Orina (EGO)
  ph                Float?
  proteinas         String?     @default("Negativo")
  glucosaOrina      String?     @default("Negativo")
  cetona            String?     @default("Negativo")
  sangre            String?     @default("Negativo")
  bilirrubina       String?     @default("Negativo")
  nitritos          String?     @default("Negativo")
  sedimento         String?     @default("Negativo")

  pdfUrl            String?
  createdAt         DateTime    @default(now())
}

// üçé BLOQUE: R24
model R24 {
  id              String      @id @default(uuid())
  consumoKcal     Float
  notas           String?
  appointmentId   String      @unique
  appointment     Appointment @relation(fields: [appointmentId], references: [id])
}

// ü•ó BLOQUE: PLANES ALIMENTICIOS
model PlanAlimenticio {
  id              String      @id @default(uuid())
  nombre          String
  detalles        String?
  appointmentId   String      @unique
  appointment     Appointment @relation(fields: [appointmentId], references: [id])
}

// üìù CONSULTA: Registro r√°pido hist√≥rico
model Consultation {
  id          String   @id @default(uuid())
  fecha       DateTime @default(now())
  peso        Float
  talla       Float
  imc         Float
  subjetivo   String?
  objetivo    String?
  planAccion  String?
  patientId   String
  createdAt   DateTime @default(now())
  patient     Patient  @relation(fields: [patientId], references: [id])
}

enum UserStatus {
  PENDING_PAYMENT
  ACTIVE
  TEST_USER
}

enum PatientStatus {
  ACTIVO
  INACTIVO
}