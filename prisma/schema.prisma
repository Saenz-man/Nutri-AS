generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// üë§ PERFIL DEL NUTRI√ìLOGO (Edgar Uriel)
model User {
  id           String        @id @default(uuid())
  nombre       String
  apellido     String
  email        String        @unique
  password     String
  telefono     String
  carrera      String
  cumplea√±os   DateTime
  fotoPerfil   String?
  fotoBanner   String?
  status       UserStatus    @default(PENDING_PAYMENT)
  maxPatients  Int           @default(10)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  appointments Appointment[]
  patients     Patient[]
}

// üë• EXPEDIENTE DEL PACIENTE
model Patient {
  id              String         @id @default(uuid())
  expediente      String         @unique
  nombre          String
  apellido        String
  email           String?
  telefono        String?
  fechaNacimiento DateTime?
  foto            String?
  nutritionistId  String
  status          PatientStatus  @default(ACTIVO)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  appointments    Appointment[]
  consultations   Consultation[]
  nutritionist    User           @relation(fields: [nutritionistId], references: [id])
}

// üìÖ CITA: El eje central del Historial Cl√≠nico
model Appointment {
  id              String        @id @default(uuid())
  fechaHora       DateTime
  motivo          String?       @default("Consulta de Seguimiento")
  status          String        @default("PENDIENTE") // PENDIENTE, ATENDIDA, CANCELADA, NO_LLEGO
  patientId       String
  nutritionistId  String
  createdAt       DateTime      @default(now())
  
  // üîó RELACIONES CL√çNICAS (Para el Timeline y KPIs)
  medicion        Medicion?     // Datos antropom√©tricos de esta cita
  r24             R24?          // Recordatorio de 24 horas de esta cita
  laboratorios    Laboratorio[] // Estudios cargados en esta fecha
  plan            PlanAlimenticio? // Dieta asignada en esta consulta

  nutritionist    User          @relation(fields: [nutritionistId], references: [id])
  patient         Patient       @relation(fields: [patientId], references: [id])
}

// üìè BLOQUE: MEDICIONES (Para KPIs de Progreso)
model Medicion {
  id            String      @id @default(uuid())
  peso          Float
  talla         Float
  imc           Float
  grasa         Float?      // % Grasa solicitado
  musculo       Float?      // % M√∫sculo solicitado
  appointmentId String      @unique
  appointment   Appointment @relation(fields: [appointmentId], references: [id])
}

// üß™ BLOQUE: ESTUDIOS DE LABORATORIO
model Laboratorio {
  id            String      @id @default(uuid())
  parametro     String      // Ej: "Glucosa"
  valor         Float
  unidad        String      // Ej: "mg/dL"
  appointmentId String
  appointment   Appointment @relation(fields: [appointmentId], references: [id])
}

// üçé BLOQUE: R24 & SMAE
model R24 {
  id            String      @id @default(uuid())
  consumoKcal   Float       // Consumo cal√≥rico detectado
  notas         String?
  appointmentId String      @unique
  appointment   Appointment @relation(fields: [appointmentId], references: [id])
}

// ü•ó BLOQUE: C√ÅLCULO DIET√âTICO / PLANES
model PlanAlimenticio {
  id            String      @id @default(uuid())
  nombre        String      // Ej: "Plan Hiperproteico V1"
  detalles      String?
  appointmentId String      @unique
  appointment   Appointment @relation(fields: [appointmentId], references: [id])
}

// üìù CONSULTA: Registro r√°pido hist√≥rico
model Consultation {
  id          String   @id @default(uuid())
  fecha       DateTime @default(now())
  peso        Float
  talla       Float
  imc         Float
  subjetivo   String?
  objetivo    String?
  planAccion  String?
  patientId   String
  createdAt   DateTime @default(now())
  patient     Patient  @relation(fields: [patientId], references: [id])
}

enum UserStatus {
  PENDING_PAYMENT
  ACTIVE
  TEST_USER
}

enum PatientStatus {
  ACTIVO
  INACTIVO
}