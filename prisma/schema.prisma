generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 游녻 PERFIL DEL NUTRI칍LOGO (Edgar Uriel)
model User {
  id           String        @id @default(uuid())
  nombre       String
  apellido     String
  email        String        @unique
  password     String
  telefono     String
  carrera      String
  cumplea침os   DateTime
  fotoPerfil   String?
  fotoBanner   String?
  status       UserStatus    @default(PENDING_PAYMENT)
  maxPatients  Int           @default(10)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  appointments Appointment[]
  patients     Patient[]
}

// 游논 EXPEDIENTE DEL PACIENTE
model Patient {
  id              String         @id @default(uuid())
  expediente      String         @unique
  nombre          String
  apellido        String
  email           String?
  telefono        String?
  fechaNacimiento DateTime?
  foto            String?
  nutritionistId  String
  status          PatientStatus  @default(ACTIVO)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  appointments    Appointment[]
  consultations   Consultation[]
  nutritionist    User           @relation(fields: [nutritionistId], references: [id])
}

// 游늰 CITA: El eje central del Historial Cl칤nico
model Appointment {
  id              String           @id @default(uuid())
  fechaHora       DateTime
  motivo          String?          @default("Consulta de Seguimiento")
  status          String           @default("PENDIENTE") // PENDIENTE, ATENDIDA, CANCELADA, NO_LLEGO
  patientId       String
  nutritionistId  String
  createdAt       DateTime         @default(now())
  
  // 游댕 RELACIONES CL칈NICAS (Para el Timeline y KPIs)
  medicion        Medicion?        // Datos antropom칠tricos de esta cita
  r24             R24?             // Recordatorio de 24 horas de esta cita
  laboratorios    Laboratorio[]    // Estudios cargados en esta fecha
  plan            PlanAlimenticio? // Dieta asignada en esta consulta

  nutritionist    User             @relation(fields: [nutritionistId], references: [id])
  patient         Patient          @relation(fields: [patientId], references: [id])
}

// 游늺 BLOQUE: MEDICIONES ANTROPOM칄TRICAS COMPLETAS
model Medicion {
  id                String      @id @default(uuid())
  appointmentId     String      @unique
  appointment       Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)

  // 游릭 B치sicos (4 Mediciones)
  peso              Float?
  talla             Float?
  tallaSentado      Float?
  envergadura       Float?

  // 游댮 Pan칤culos / Pliegues (8 Mediciones en mm)
  triceps           Float?
  subescapular      Float?
  biceps            Float?
  crestaIliaca      Float?
  supraespinal      Float?
  abdominal         Float?
  muslo             Float?
  pierna            Float?

  // 游댯 Bioimpedancia (B치scula Inteligente)
  grasaEquipo       Float?      // % Grasa directo del equipo
  agua              Float?      // % Agua corporal
  grasaVisceral     Float?      // Nivel 1-20
  edadMetabolica    Int?
  masaOsea          Float?

  // 游댖 Circunferencias, Di치metros e Indicadores (cm)
  imc               Float?      // 칈ndice de Masa Corporal
  icc               Float?      // 칈ndice Cintura-Cadera
  cintura           Float?
  cadera            Float?
  brazoR            Float?      // Brazo relajado
  brazoC            Float?      // Brazo contra칤do
  piernaCirc        Float?      // Circunferencia de pierna (distinto al pan칤culo)
  estiloideo        Float?      // Di치metro de mu침eca
  femur             Float?      // Di치metro de f칠mur
  humero            Float?      // Di치metro de h칰mero

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
}

// 游빍 BLOQUE: ESTUDIOS DE LABORATORIO
model Laboratorio {
  id              String      @id @default(uuid())
  appointmentId   String      @unique
  appointment     Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)

  // 游빍 Perfil Bioqu칤mico y Nutricional
  glucosa         Float?
  urea            Float?
  creatinina      Float?
  hemoglobina     Float?
  ferritina       Float?
  proteinasTotales Float?

  // 游볼 Perfil Lip칤dico
  colesterolTotal Float?
  hdl             Float?
  ldl             Float?
  trigliceridos   Float?
  indiceAterogenico Float?

  // 游뛓 EGO (Examen General de Orina)
  ph              Float?
  densidad        Float?
  aspecto         String?
  sedimento       String?

  pdfUrl          String?      // 游늭 Para el adjunto opcional
  createdAt       DateTime     @default(now())
}

// 游꼝 BLOQUE: R24 & SMAE
model R24 {
  id              String      @id @default(uuid())
  consumoKcal     Float       // Consumo cal칩rico detectado
  notas           String?
  appointmentId   String      @unique
  appointment     Appointment @relation(fields: [appointmentId], references: [id])
}

// 游볭 BLOQUE: C츼LCULO DIET칄TICO / PLANES
model PlanAlimenticio {
  id              String      @id @default(uuid())
  nombre          String      // Ej: "Plan Hiperproteico V1"
  detalles        String?
  appointmentId   String      @unique
  appointment     Appointment @relation(fields: [appointmentId], references: [id])
}

// 游닇 CONSULTA: Registro r치pido hist칩rico
model Consultation {
  id          String   @id @default(uuid())
  fecha       DateTime @default(now())
  peso        Float
  talla       Float
  imc         Float
  subjetivo   String?
  objetivo    String?
  planAccion  String?
  patientId   String
  createdAt   DateTime @default(now())
  patient     Patient  @relation(fields: [patientId], references: [id])
}

enum UserStatus {
  PENDING_PAYMENT
  ACTIVE
  TEST_USER
}

enum PatientStatus {
  ACTIVO
  INACTIVO
}